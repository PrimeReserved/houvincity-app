import{aO as xn,r as l,aP as xt,aQ as wn,aC as jn,u as ae,aR as ge,j as o,aS as De,aT as Vt,F as z,i as fe,aU as Pn,aV as wt,aW as En,k as H,o as F,q as je,t as A,B as ie,aX as Sn,aY as kn,aZ as Cn,a_ as In,a$ as jt,b0 as Rn,b1 as Pt,b2 as _n,b3 as Re,S as pe,b4 as Et,b5 as $n,b6 as Tn,b7 as On,n as St,N as _e,m as $e,a0 as Ht,b8 as An,W as it,b9 as Jt,ba as Dn,bb as Ln,bc as Be,a8 as zn,bd as Mn,be as Un,bf as Wn,bg as he,l as Nn,I as Fn,bh as Kn,bi as Bn,bj as qn,bk as Gt,bl as Vn,T as Hn,bm as Jn,h as Gn,f as Te,bn as Oe,bo as Xe,bp as Xn,bq as Zn,br as Yn,$ as Qn,bs as at,a4 as er,bt as tr,K as nr,bu as rr,au as ir,bv as ar,aK as Xt,aa as Zt,ac as Yt,bw as or,ak as sr,bx as cr,by as lr}from"./sanity-6cbb77ad.js";import{q as ur,c as dr}from"./DisplayedDocumentBroadcaster-b5c413d9.js";function pr({children:e,isValidProp:n,...t}){n&&xn(n),t={...l.useContext(xt),...t},t.isStatic=wn(()=>t.isStatic);const r=l.useMemo(()=>t,[JSON.stringify(t.transition),t.transformPagePoint,t.reducedMotion]);return l.createElement(xt.Provider,{value:r},e)}const fr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ot=/_key\s*==\s*['"](.*)['"]/,hr=/^\d*:\d*$/;function st(e){return typeof e=="number"||typeof e=="string"&&/^\[\d+\]$/.test(e)}function Le(e){return typeof e=="string"?ot.test(e.trim()):typeof e=="object"&&"_key"in e}function Qt(e){if(typeof e=="string"&&hr.test(e))return!0;if(!Array.isArray(e)||e.length!==2)return!1;const[n,t]=e;return(typeof n=="number"||n==="")&&(typeof t=="number"||t==="")}function vr(e,n,t){const r=typeof n=="string"?en(n):n;if(!Array.isArray(r))throw new Error("Path must be an array or a string");let i=e;for(let a=0;a<r.length;a++){const c=r[a];if(st(c)){if(!Array.isArray(i))return t;i=i[c]}if(Le(c)){if(!Array.isArray(i))return t;i=i.find(v=>v._key===c._key)}if(typeof c=="string"&&(i=typeof i=="object"&&i!==null?i[c]:void 0),typeof i>"u")return t}return i}function mr(e){if(!Array.isArray(e))throw new Error("Path is not an array");return e.reduce((n,t,r)=>{const i=typeof t;if(i==="number")return`${n}[${t}]`;if(i==="string")return`${n}${r===0?"":"."}${t}`;if(Le(t)&&t._key)return`${n}[_key=="${t._key}"]`;if(Array.isArray(t)){const[a,c]=t;return`${n}[${a}:${c}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(t)}\``)},"")}function en(e){if(typeof e!="string")throw new Error("Path is not a string");const n=e.match(fr);if(!n)throw new Error("Invalid path string");return n.map(gr)}function gr(e){return st(e)?yr(e):Le(e)?br(e):Qt(e)?xr(e):e}function yr(e){return Number(e.replace(/[^\d]/g,""))}function br(e){return{_key:e.match(ot)[1]}}function xr(e){const[n,t]=e.split(":").map(r=>r===""?r:Number(r));return[n,t]}var tn=Object.freeze({__proto__:null,fromString:en,get:vr,isIndexSegment:st,isIndexTuple:Qt,isKeySegment:Le,reKeySegment:ot,toString:mr});const kt="drafts.";function aa(e){return e.startsWith(kt)?e.slice(kt.length):e}const Ct={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},It={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function wr(e){return`$${e.map(n=>typeof n=="string"?`['${n.replace(/[\f\n\r\t'\\]/g,t=>Ct[t])}']`:typeof n=="number"?`[${n}]`:n._key!==""?`[?(@._key=='${n._key.replace(/['\\]/g,t=>Ct[t])}')]`:`[${n._index}]`).join("")}`}function oa(e){const n=[],t=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let r;for(;(r=t.exec(e))!==null;){if(r[1]!==void 0){const i=r[1].replace(/\\(\\|f|n|r|t|')/g,a=>It[a]);n.push(i);continue}if(r[2]!==void 0){n.push(parseInt(r[2],10));continue}if(r[3]!==void 0){const i=r[3].replace(/\\(\\')/g,a=>It[a]);n.push({_key:i,_index:-1});continue}}return n}function jr(e){return e.map(n=>{if(typeof n=="string"||typeof n=="number")return n;if(n._index!==-1)return n._index;throw new Error(`invalid segment:${JSON.stringify(n)}`)})}function sa(e,n){if(!(n!=null&&n.mappings))return;const t=wr(jr(e));if(n.mappings[t]!==void 0)return{mapping:n.mappings[t],matchedPath:t,pathSuffix:""};const r=Object.entries(n.mappings).filter(([v])=>t.startsWith(v)).sort(([v],[d])=>d.length-v.length);if(r.length==0)return;const[i,a]=r[0],c=t.substring(i.length);return{mapping:a,matchedPath:i,pathSuffix:c}}function Pr(e){return e!==null&&Array.isArray(e)}function Rt(e){return typeof e=="object"&&e!==null}function qe(e,n,t=[]){return Pr(e)?e.map((r,i)=>{if(Rt(r)){const a=r._key;if(typeof a=="string")return qe(r,n,t.concat({_key:a,_index:i}))}return qe(r,n,t.concat(i))}):Rt(e)?Object.fromEntries(Object.entries(e).map(([r,i])=>[r,qe(i,n,t.concat(r))])):n(e,t)}const nn="sanity.previewUrlSecret",Er="sanity-preview-url-secret",Sr="2023-11-09",ze="sanity-preview-secret",ct="sanity-preview-pathname",kr=3600,Cr=`*[_type == "${nn}" && dateTime(_updatedAt) <= dateTime(now()) - 3600]`,Ir="sanity.preview-url-secret";function Rr(e){const n=new URL(e);return n.searchParams.delete(ct),n.searchParams.delete(ze),n}function _r(e){return e.searchParams.has(ze)}function $r(e,n,t){const r=new URL(e);return r.searchParams.set(ze,n),r.searchParams.set(ct,t),r}async function rn(e,n,t,r,i=jn()){const a=e.withConfig({apiVersion:Sr});try{const c=new Date(Date.now()+1e3*kr),v=`${Er}.${i}`,d=function(){if(typeof crypto<"u"){const u=new Uint8Array(16);crypto.getRandomValues(u);let s="";for(let p=0;p<u.length;p++)s+=u[p].toString(16).padStart(2,"0");return s=btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]+$/,""),s}return Math.random().toString(36).slice(2)}(),m=a.patch(v).set({secret:d,source:n,studioUrl:t,userId:r});return await a.transaction().createOrReplace({_id:v,_type:nn}).patch(m).commit({tag:Ir}),{secret:d,expiresAt:c}}finally{await a.delete({query:Cr})}}function Tr(e){for(var n=[],t=0;t<e.length;){var r=e[t];if(r==="*"||r==="+"||r==="?"){n.push({type:"MODIFIER",index:t,value:e[t++]});continue}if(r==="\\"){n.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});continue}if(r==="{"){n.push({type:"OPEN",index:t,value:e[t++]});continue}if(r==="}"){n.push({type:"CLOSE",index:t,value:e[t++]});continue}if(r===":"){for(var i="",a=t+1;a<e.length;){var c=e.charCodeAt(a);if(c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||c===95){i+=e[a++];continue}break}if(!i)throw new TypeError("Missing parameter name at ".concat(t));n.push({type:"NAME",index:t,value:i}),t=a;continue}if(r==="("){var v=1,d="",a=t+1;if(e[a]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(a));for(;a<e.length;){if(e[a]==="\\"){d+=e[a++]+e[a++];continue}if(e[a]===")"){if(v--,v===0){a++;break}}else if(e[a]==="("&&(v++,e[a+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(a));d+=e[a++]}if(v)throw new TypeError("Unbalanced pattern at ".concat(t));if(!d)throw new TypeError("Missing pattern at ".concat(t));n.push({type:"PATTERN",index:t,value:d}),t=a;continue}n.push({type:"CHAR",index:t,value:e[t++]})}return n.push({type:"END",index:t,value:""}),n}function Or(e,n){n===void 0&&(n={});for(var t=Tr(e),r=n.prefixes,i=r===void 0?"./":r,a="[^".concat(me(n.delimiter||"/#?"),"]+?"),c=[],v=0,d=0,m="",u=function(y){if(d<t.length&&t[d].type===y)return t[d++].value},s=function(y){var P=u(y);if(P!==void 0)return P;var k=t[d],I=k.type,T=k.index;throw new TypeError("Unexpected ".concat(I," at ").concat(T,", expected ").concat(y))},p=function(){for(var y="",P;P=u("CHAR")||u("ESCAPED_CHAR");)y+=P;return y};d<t.length;){var f=u("CHAR"),g=u("NAME"),b=u("PATTERN");if(g||b){var h=f||"";i.indexOf(h)===-1&&(m+=h,h=""),m&&(c.push(m),m=""),c.push({name:g||v++,prefix:h,suffix:"",pattern:b||a,modifier:u("MODIFIER")||""});continue}var x=f||u("ESCAPED_CHAR");if(x){m+=x;continue}m&&(c.push(m),m="");var j=u("OPEN");if(j){var h=p(),C=u("NAME")||"",w=u("PATTERN")||"",E=p();s("CLOSE"),c.push({name:C||(w?v++:""),pattern:C&&!w?a:w,prefix:h,suffix:E,modifier:u("MODIFIER")||""});continue}s("END")}return c}function Ar(e,n){var t=[],r=on(e,t,n);return Dr(r,t,n)}function Dr(e,n,t){t===void 0&&(t={});var r=t.decode,i=r===void 0?function(a){return a}:r;return function(a){var c=e.exec(a);if(!c)return!1;for(var v=c[0],d=c.index,m=Object.create(null),u=function(p){if(c[p]===void 0)return"continue";var f=n[p-1];f.modifier==="*"||f.modifier==="+"?m[f.name]=c[p].split(f.prefix+f.suffix).map(function(g){return i(g,f)}):m[f.name]=i(c[p],f)},s=1;s<c.length;s++)u(s);return{path:v,index:d,params:m}}}function me(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function an(e){return e&&e.sensitive?"":"i"}function Lr(e,n){if(!n)return e;for(var t=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,i=t.exec(e.source);i;)n.push({name:i[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),i=t.exec(e.source);return e}function zr(e,n,t){var r=e.map(function(i){return on(i,n,t).source});return new RegExp("(?:".concat(r.join("|"),")"),an(t))}function Mr(e,n,t){return Ur(Or(e,t),n,t)}function Ur(e,n,t){t===void 0&&(t={});for(var r=t.strict,i=r===void 0?!1:r,a=t.start,c=a===void 0?!0:a,v=t.end,d=v===void 0?!0:v,m=t.encode,u=m===void 0?function(T){return T}:m,s=t.delimiter,p=s===void 0?"/#?":s,f=t.endsWith,g=f===void 0?"":f,b="[".concat(me(g),"]|$"),h="[".concat(me(p),"]"),x=c?"^":"",j=0,C=e;j<C.length;j++){var w=C[j];if(typeof w=="string")x+=me(u(w));else{var E=me(u(w.prefix)),y=me(u(w.suffix));if(w.pattern)if(n&&n.push(w),E||y)if(w.modifier==="+"||w.modifier==="*"){var P=w.modifier==="*"?"?":"";x+="(?:".concat(E,"((?:").concat(w.pattern,")(?:").concat(y).concat(E,"(?:").concat(w.pattern,"))*)").concat(y,")").concat(P)}else x+="(?:".concat(E,"(").concat(w.pattern,")").concat(y,")").concat(w.modifier);else w.modifier==="+"||w.modifier==="*"?x+="((?:".concat(w.pattern,")").concat(w.modifier,")"):x+="(".concat(w.pattern,")").concat(w.modifier);else x+="(?:".concat(E).concat(y,")").concat(w.modifier)}}if(d)i||(x+="".concat(h,"?")),x+=t.endsWith?"(?=".concat(b,")"):"$";else{var k=e[e.length-1],I=typeof k=="string"?h.indexOf(k[k.length-1])>-1:k===void 0;i||(x+="(?:".concat(h,"(?=").concat(b,"))?")),I||(x+="(?=".concat(h,"|").concat(b,")"))}return new RegExp(x,an(t))}function on(e,n,t){return e instanceof RegExp?Lr(e,n):Array.isArray(e)?zr(e,n,t):Mr(e,n,t)}function Wr(e){const{draftMode:n,previewMode:t,origin:r=typeof location>"u"?"https://localhost":location.origin}=e,i=(t==null?void 0:t.enable)||(n==null?void 0:n.enable);let{preview:a="/"}=e;const c=new URL(a,r),v=i?new URL(i,r):void 0;return async d=>{try{if(d.previewSearchParam){const u=new URL(d.previewSearchParam,c);u.origin===c.origin&&(a=`${u.pathname}${u.search}`)}else if(d.referrer){const u=new URL(d.referrer);u.origin===c.origin&&(a=`${u.pathname}${u.search}`)}}catch{}typeof location<"u"&&location.origin===c.origin&&d.studioBasePath&&(a.startsWith(`${d.studioBasePath}/`)||a===d.studioBasePath)&&(a=e.preview||"/");const m=new URL(a,c);if(v){const u=new URL(v),{searchParams:s}=u;return s.set(ze,d.previewUrlSecret),m.pathname!==u.pathname&&s.set(ct,`${m.pathname}${m.search}`),u.toString()}return m.toString()}}const Nr=e=>typeof e=="object"&&typeof e.then=="function",Se=[];function Fr(e,n,t=(r,i)=>r===i){if(e===n)return!0;if(!e||!n)return!1;const r=e.length;if(n.length!==r)return!1;for(let i=0;i<r;i++)if(!t(e[i],n[i]))return!1;return!0}function Kr(e,n=null,t=!1,r={}){n===null&&(n=[e]);for(const a of Se)if(Fr(n,a.keys,a.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(a,"error"))throw a.error;if(Object.prototype.hasOwnProperty.call(a,"response"))return r.lifespan&&r.lifespan>0&&(a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout(a.remove,r.lifespan)),a.response;if(!t)throw a.promise}const i={keys:n,equal:r.equal,remove:()=>{const a=Se.indexOf(i);a!==-1&&Se.splice(a,1)},promise:(Nr(e)?e:e(...n)).then(a=>{i.response=a,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(a=>i.error=a)};if(Se.push(i),!t)throw i.promise}const _t=(e,n,t)=>Kr(e,n,!1,t);var Br=Object.defineProperty,qr=(e,n,t)=>((r,i,a)=>i in r?Br(r,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[i]=a)(e,typeof n!="symbol"?n+"":n,t);let ke;const Vr=new Uint8Array(16);function Hr(){if(!ke&&(ke=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ke))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ke(Vr)}const U=[];for(let e=0;e<256;++e)U.push((e+256).toString(16).slice(1));var $t={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ce(e,n,t){if($t.randomUUID&&!n&&!e)return $t.randomUUID();const r=(e=e||{}).random||(e.rng||Hr)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,function(i,a=0){return U[i[a+0]]+U[i[a+1]]+U[i[a+2]]+U[i[a+3]]+"-"+U[i[a+4]]+U[i[a+5]]+"-"+U[i[a+6]]+U[i[a+7]]+"-"+U[i[a+8]]+U[i[a+9]]+"-"+U[i[a+10]]+U[i[a+11]]+U[i[a+12]]+U[i[a+13]]+U[i[a+14]]+U[i[a+15]]}(r)}const Jr=1e3,Gr=1e3,Xr=500,Zr=["handshake/syn","handshake/syn-ack","handshake/ack"],Tt=e=>Zr.some(n=>n===e),Yr=({data:e={}})=>typeof e=="object"&&e!==null&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every(n=>n in e)&&e.type.startsWith("handshake/");function Ot(e){const n=e.target,t=e.connectTo.map(s=>({buffer:[],config:s,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0}));function r(s){window.clearInterval(s.interval)}function i(s){const{data:p}=s;if(Tt(p.type)){const f=t.find(g=>g.config.id===p.from);f&&p.type==="handshake/syn-ack"&&(d(f,"connected"),m(f,"handshake/ack",{id:f.id}))}}const a=s=>{var p,f,g;const b=s.data;if(!Tt(b.type)&&t.find(h=>h.id===b.connectionId)){const h=t.find(x=>x.config.id===b.from);if(h){const x=[b.type,b.data];(f=(p=h.config).onEvent)==null||f.call(p,...x),(g=e.onEvent)==null||g.call(e,...x),u(h,"channel/response",{responseTo:b.id},!1)}}};function c(s){var p;if(Yr(s))console.error(`Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:
https://github.com/sanity-io/visual-editing`);else if(function(f){const{data:g,origin:b}=f;return g.domain==="sanity/channels"&&g.to==e.id&&t.map(h=>h.config.id).includes(g.from)&&g.type!=="channel/response"&&b===e.targetOrigin}(s)){const{data:f}=s;(p=t.find(g=>g.config.id===f.from))==null||p.handler(s)}}function v(s){s.heartbeat&&window.clearInterval(s.heartbeat)}function d(s,p){var f,g,b;s.status=p,(g=(f=s.config).onStatusUpdate)==null||g.call(f,p,s.config.id),(b=e.onStatusUpdate)==null||b.call(e,p,s.config.id),p==="connecting"||p==="reconnecting"?(s.handler=i,v(s),function(h){h.id=Ce(),h.interval=window.setInterval(()=>{m(h,"handshake/syn",{id:h.id})},Xr)}(s)):p==="connected"?(s.handler=a,r(s),function(h){if(v(h),h.config.heartbeat){const x=typeof h.config.heartbeat=="number"?h.config.heartbeat:Gr;h.heartbeat=window.setInterval(()=>{u(h,"channel/heartbeat")},x)}}(s),function(h){const x=[...h.buffer];h.buffer.splice(0,h.buffer.length),x.forEach(({type:j,data:C})=>{u(h,j,C)})}(s)):p==="disconnected"&&(s.id=null,s.handler=i,r(s),v(s))}function m(s,p,f){if(!s.id)throw new Error("No channel ID set");const g={connectionId:s.id,data:f,domain:"sanity/channels",from:e.id,id:Ce(),to:s.config.id,type:p};try{n==null||n.postMessage(g,{targetOrigin:"*"})}catch{throw new Error(`Failed to postMessage '${g.id}' on '${e.id}'`)}}function u(s,p,f,g=!0){const b=Ce();if(s.status==="connecting"||s.status==="reconnecting"||s.status==="disconnected")return void s.buffer.push({type:p,data:f});if(!s.id)throw new Error("No channel ID set");const h={connectionId:s.id,data:f,domain:"sanity/channels",from:e.id,id:b,to:s.config.id,type:p};if(g){const x=setTimeout(()=>{h.connectionId===s.id&&(window.removeEventListener("message",j,!1),p!=="channel/heartbeat"&&s.buffer.push({type:p,data:f}),d(s,"reconnecting"),console.warn(`Received no response to message '${h.type}' on client '${e.id}' (ID: '${h.id}').`))},Jr),j=C=>{var w;const{data:E}=C;E.type==="channel/response"&&(w=E.data)!=null&&w.responseTo&&E.data.responseTo===h.id&&(window.removeEventListener("message",j,!1),clearTimeout(x))};window.addEventListener("message",j,!1)}try{n==null||n.postMessage(h,{targetOrigin:e.targetOrigin})}catch{throw new Error(`Failed to postMessage '${h.id}' on client '${e.id}'`)}}return window.addEventListener("message",c,!1),t.forEach(s=>{d(s,"connecting")}),{destroy:function(){t.forEach(s=>{["disconnected"].includes(s.status)||(u(s,"channel/disconnect",{id:s.id},!1),d(s,"disconnected"))}),window.removeEventListener("message",c,!1),t.forEach(s=>{v(s),r(s)})},send:function(s,p,f){(s?Array.isArray(s)?[...s]:[s]:t).forEach(g=>{const b=t.find(h=>h.config.id===g);if(!b)throw new Error("Invalid channel ID");u(b,p,f)})}}}var Qr=class extends Error{constructor(e){super(e[0].message),qr(this,"issues"),this.name="ValiError",this.issues=e}};function Ze(e,n){return Array.isArray(e)?[void 0,e]:[e,n]}function sn(e,n,t,r,i){var a,c,v,d,m;const u=(m=(d=(v=(c=(a=n.message)!=null?a:function(s,p){var f;return(f=void 0)==null?void 0:f.get(p)}(t,i.lang))!=null?c:e?(i.lang,void 0):null)!=null?v:r==null?void 0:r.message)!=null?d:function(s){}(i.lang))!=null?m:i.message;return typeof u=="function"?u(i):u}function Me(e,n,t){return{typed:e,output:n,issues:t}}function lt(e){let n=typeof e;return n==="object"&&(n=e?Object.getPrototypeOf(e).constructor.name:"null"),n==="string"?`"${e}"`:n==="number"||n==="bigint"||n==="boolean"?`${e}`:n}function ei(e,n,t){var r;const i=(r=t.received)!=null?r:lt(t.input),a={reason:e.type,context:t.context.type,expected:t.context.expects,received:i,message:`Invalid ${t.label}: ${t.context.expects?`Expected ${t.context.expects} but r`:"R"}eceived ${i}`,input:t.input,requirement:t.context.requirement,path:t.path,lang:n==null?void 0:n.lang,abortEarly:n==null?void 0:n.abortEarly,abortPipeEarly:n==null?void 0:n.abortPipeEarly,skipPipe:n==null?void 0:n.skipPipe};return a.message=sn(!1,t.context,t.reference,n,a),a}function cn(e,n,t,r){if(e.pipe&&(t==null||!t.skipPipe))for(const i of e.pipe){const a=i._parse(n);if(a.issues){for(const c of a.issues){const v=ei(e,t,c);r?r.push(v):r=[v]}if(t!=null&&t.abortEarly||t!=null&&t.abortPipeEarly)break}else n=a.output}return Me(!0,n,r)}function ut(e,n,t,r,i){var a,c;const v=lt(t),d=(a=i==null?void 0:i.expected)!=null?a:e.expects,m={reason:(c=i==null?void 0:i.reason)!=null?c:"type",context:e.type,expected:d,received:v,message:`Invalid type: Expected ${d} but received ${v}`,input:t,path:i==null?void 0:i.path,issues:i==null?void 0:i.issues,lang:r==null?void 0:r.lang,abortEarly:r==null?void 0:r.abortEarly,abortPipeEarly:r==null?void 0:r.abortPipeEarly,skipPipe:r==null?void 0:r.skipPipe};return m.message=sn(!0,e,n,r,m),{typed:!1,output:t,issues:[m]}}function dt(e,n){return{...e,fallback:n,_parse(t,r){const i=e._parse(t,r);return i.issues?Me(!0,function(a,c){return typeof a.fallback=="function"?a.fallback(c):a.fallback}(this,{input:t,issues:i.issues})):i}}}function pt(e,n){const[t,r]=Ze(e,n);return{type:"boolean",expects:"boolean",async:!1,message:t,pipe:r,_parse(i,a){return typeof i=="boolean"?cn(this,i,a):ut(this,pt,i,a)}}}function Ie(e,n,t,r){const[i,a,c]=function(d,m,u){if(!d||typeof d=="object"&&!Array.isArray(d)){const[f,g]=Ze(m,u);return[d,f,g]}const[s,p]=Ze(d,m);return[void 0,s,p]}(n,t,r);let v;return{type:"object",expects:"Object",async:!1,entries:e,rest:i,message:a,pipe:c,_parse(d,m){if(d&&typeof d=="object"){v=v??Object.entries(this.entries);let u,s=!0;const p={};for(const[f,g]of v){const b=d[f],h=g._parse(b,m);if(h.issues){const x={type:"object",origin:"value",input:d,key:f,value:b};for(const j of h.issues)j.path?j.path.unshift(x):j.path=[x],u==null||u.push(j);if(u||(u=h.issues),m!=null&&m.abortEarly){s=!1;break}}h.typed||(s=!1),(h.output!==void 0||f in d)&&(p[f]=h.output)}if(this.rest&&(m==null||!m.abortEarly||!u)){for(const f in d)if(!(f in this.entries)){const g=d[f],b=this.rest._parse(g,m);if(b.issues){const h={type:"object",origin:"value",input:d,key:f,value:g};for(const x of b.issues)x.path?x.path.unshift(h):x.path=[h],u==null||u.push(x);if(u||(u=b.issues),m!=null&&m.abortEarly){s=!1;break}}b.typed||(s=!1),p[f]=b.output}}return s?cn(this,p,m,u):Me(!1,p,u)}return ut(this,Ie,d,m)}}}function Ue(e,n){return{type:"picklist",expects:e.map(lt).join(" | "),async:!1,options:e,message:n,_parse(t,r){return this.options.includes(t)?Me(!0,t):ut(this,Ue,t,r)}}}function Ye(e,n,t){const r=e._parse(n,function(i){var a,c,v,d;return{lang:(a=i==null?void 0:i.lang)!=null?a:void 0,message:i==null?void 0:i.message,abortEarly:(c=i==null?void 0:i.abortEarly)!=null?c:void 0,abortPipeEarly:(v=i==null?void 0:i.abortPipeEarly)!=null?v:void 0,skipPipe:(d=i==null?void 0:i.skipPipe)!=null?d:void 0}}(t));if(r.issues)throw new Qr(r.issues);return r.output}const ti=/^([A-Za-z]+):([0-9]+)$/,ni=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,ri=/^([A-Za-z]+):([a-z0-9]+)$/;function ii(e,n){return`${e}-${typeof n=="string"?n:JSON.stringify(n)}`}const At={alt:"altKey",ctrl:"ctrlKey",mod:typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function Dt(e){return e.key==="Alt"}function ln(e,n){let t;return(...r)=>{clearTimeout(t),t=setTimeout(()=>{e.apply(e,r)},n)}}const We=l.createContext(null);We.displayName="PanelsContext";const ai=ae.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,ft=function({children:e,defaultSize:n=null,id:t,minWidth:r,maxWidth:i,order:a=0}){const c=l.useContext(We);if(c===null)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:v,registerElement:d,unregisterElement:m}=c,u=v(t);return l.useLayoutEffect(()=>(d(t,{id:t,type:"panel",defaultSize:n,maxWidth:i??null,minWidth:r??0,order:a}),()=>{m(t)}),[t,n,a,i,r,d,m]),o.jsx(ai,{style:u,children:e})},un="presentation/panels",Lt=()=>JSON.parse(localStorage.getItem(un)||"{}"),zt=e=>e.map(n=>[n.id,n.order].join(":")).join(",");function oi(){return l.useMemo(()=>{const e=(n,t)=>{const r=Lt(),i=zt(n);(a=>{localStorage.setItem(un,JSON.stringify(a))})({...r,[i]:t})};return{get:n=>{const t=Lt(),r=zt(n);return Array.isArray(t[r])&&t[r].some(i=>i===null)?void 0:t[r]},set:e,setDebounced:ln(e,100)}},[])}function Qe(e,n,t){const{maxWidth:r,minWidth:i}=e,a=r==null?100:r/t*100,c=i/t*100;return Math.min(a,Math.max(c,n))}function si(e,n,t){if(e.length===1)return"100";const r=t[e.findIndex(i=>i.id===n)];return r==null?"0":r.toPrecision(10)}function Mt(e,n,t=0,r=null){return e.clientX-(r||n.getBoundingClientRect()).left-t}function Ve(e){return e.type==="panel"}function Ut(e){return e.type==="resizer"}function Wt(e){return Array.from(e.values()).sort(({order:n},{order:t})=>n==null&&t==null?0:n==null?-1:t==null?1:n-t)}function Nt(e,n,t){const r=n.reduce((c,v)=>c+v,0),i=[...n].map(c=>c/r*100);let a=0;for(let c=0;c<e.length;c++){const v=e[c],d=i[c],m=Qe(v,d,t);d!=m&&(a+=d-m,i[c]=m)}if(a.toFixed(3)!=="0.000")for(let c=0;c<e.length;c++){const v=e[c];let{maxWidth:d,minWidth:m}=v;m=m/t*100,d!=null&&(d=d/t*100);const u=Math.min(d??100,Math.max(m,i[c]+a));if(u!==i[c]&&(a-=u-i[c],i[c]=u,Math.abs(a).toFixed(3)==="0.000"))break}return i}const ci=ae.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,li=function({children:e}){const n=l.useRef(null),[t,r]=l.useState(new Map),i=l.useMemo(()=>Wt(t).filter(Ve),[t]),[a,c]=l.useState([]),[v,d]=l.useState(null),m=l.useRef({elements:t,panels:i,widths:a}),u=l.useCallback(C=>({flexGrow:si(i,C,a),pointerEvents:v===null?void 0:"none"}),[v,i,a]),s=l.useCallback((C,w)=>{r(E=>{if(E.has(C))return E;const y=new Map(E);return y.set(C,w),y})},[]),p=l.useCallback(C=>{r(w=>{if(!w.has(C))return w;const E=new Map(w);return E.delete(C),E})},[]),f=l.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),g=l.useCallback((C,w)=>{const E=Wt(t),y=E.findIndex(I=>I.id===C),P=t.get(C);if(!P||!Ut(P))return;const k=P.el.current;k&&(f.current={resizerIndex:y,panelBefore:E.reduce((I,T,D)=>Ve(T)&&D<y?T:I,null),panelAfter:E.reduce((I,T,D)=>I===null&&Ve(T)&&D>y?T:I,null),containerWidth:window.innerWidth,startX:w.pageX,dragOffset:Mt(w,k),resizerRect:k.getBoundingClientRect(),widths:m.current.widths},d(C))},[t]),b=l.useCallback(()=>{d(null)},[]),h=l.useCallback((C,w)=>{w.preventDefault(),w.stopPropagation();const{containerWidth:E,dragOffset:y,panelBefore:P,panelAfter:k,resizerRect:I}=f.current;if(P==null||k==null)return;const T=t.get(C);if(!T||!Ut(T))return;const D=T.el.current;if(!D)return;const J=Mt(w,D,y,I);if(J===0)return;const{widths:ce}=m.current,X=function(W,Z,le,N,ve,Y){const{panels:Q,widths:G}=ve,{widths:ye}=Y,O=ye||G,ee=[...O];{const te=W<0?N:le,ne=O[Q.findIndex(Ne=>Ne.id===te.id)],se=Qe(te,ne+Math.abs(W),Z);if(ne===se)return O;W=W<0?ne-se:se-ne}let oe=0,be=W<0?le:N,K=Q.findIndex(te=>te.id===be.id);for(;;){const te=Q[K],ne=O[K],se=Qe(te,ne-(Math.abs(W)-Math.abs(oe)),Z);if(ne!==se&&(oe+=ne-se,ee[K]=se,oe.toPrecision(10).localeCompare(Math.abs(W).toPrecision(10),void 0,{numeric:!0})>=0))break;if(W<0){if(--K<0)break}else if(++K>=Q.length)break}return oe===0?O:(be=W<0?N:le,K=Q.findIndex(te=>te.id===be.id),ee[K]=O[K]+oe,ee)}(J/n.current.getBoundingClientRect().width*100,E,P,k,m.current,f.current);ce.some((W,Z)=>W!==X[Z])&&c(X)},[t]);l.useLayoutEffect(()=>{m.current.elements=t,m.current.panels=i,m.current.widths=a},[t,i,a]);const x=oi();l.useLayoutEffect(()=>{const{widths:C}=m.current;if(C.length===i.length)return;const w=x.get(i);if(w){const y=Nt(i,w,window.innerWidth);return void c(y)}const E=function(y){let P=y.length,k=100;const I=y.map(D=>D.defaultSize?(k-=D.defaultSize,P-=1,D.defaultSize):null),T=k/P;return I.map(D=>D===null?T:D)}(i);c(E)},[x,i]),l.useEffect(()=>{a.length&&x.setDebounced(i,a)},[x,i,a]),l.useLayoutEffect(()=>{const C=new ResizeObserver(()=>{const{panels:w,widths:E}=m.current,y=Nt(w,E,window.innerWidth);E.some((P,k)=>P!==y[k])&&c(y)});return C.observe(n.current),()=>{C.disconnect()}},[]);const j=l.useMemo(()=>({activeResizer:v,drag:h,getPanelStyle:u,registerElement:s,startDragging:g,stopDragging:b,unregisterElement:p}),[v,h,u,s,g,b,p]);return o.jsx(We.Provider,{value:j,children:o.jsx(ci,{ref:n,children:e})})};function ht(e){const{children:n,message:t,onRetry:r,onContinueAnyway:i,...a}=e,{t:c}=fe(he),v=o.jsx(ie,{fontSize:1,mode:"ghost",onClick:r,text:c("error-card.retry-button.text")}),d=o.jsx(ie,{fontSize:1,mode:"ghost",tone:"critical",onClick:i,text:c("error-card.continue-button.text")});return o.jsx(H,{height:"fill",...a,children:o.jsx(z,{align:"center",height:"fill",justify:"center",children:o.jsx(Nn,{padding:4,sizing:"border",width:0,children:o.jsxs(pe,{space:4,children:[o.jsxs(pe,{space:3,children:[o.jsx(A,{size:1,weight:"semibold",children:c("error-card.title")}),o.jsx(A,{muted:!0,size:1,children:t})]}),n,r&&i?o.jsxs(Fn,{space:2,children:[v,d]}):r?o.jsx(F,{children:v}):i?o.jsx(F,{children:d}):null]})})})})}function ui(e){const n=["comment","inspect","instruction","pathKey","rev","since","template","prefersLatestPublished","view"];return function(t={}){const r=Object.entries(t).map(([i,a])=>`${i}=${a}`).join("&");return r.length?`?${r}`:""}(Object.entries(e).filter(([t])=>n.includes(t)).reduce((t,[r,i])=>i==null?t:{...t,[r]:i},{}))}const di=l.forwardRef(function(e,n){const{params:t,structureParams:r}=ge();return o.jsx(De,{...e,ref:n,state:{type:void 0,_searchParams:Object.entries({...r,perspective:t.perspective,preview:t.preview})},title:void 0})}),pi=l.forwardRef(function(e,n){const{documentId:t,documentType:r,parentRefPath:i,template:a,previewUrl:c,...v}=e,{params:d}=ge();return o.jsx(De,{...v,ref:n,state:{id:t,type:r,_searchParams:Object.entries({preview:c,prefersLatestPublished:d.perspective==="published"?"true":void 0})},title:void 0})});function dn(e){const{children:n,onStructureParams:t,params:r,previewUrl:i,refs:a}=e,{state:c,resolvePathFromState:v}=it(),d=Jt(Object.fromEntries(c._searchParams||[])),m=l.useCallback(s=>`${v(c)}${ui({...d,...s})}`,[v,d,c]),u=l.useMemo(()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:r,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:s=>{const{childId:p,...f}=s,g=a==null?void 0:a.find(h=>h._id===p||at(h._id)===p),{params:b}=ge();return g?o.jsx(De,{...f,state:{id:p,type:g._type,_searchParams:Object.entries({preview:i,prefersLatestPublished:b.perspective==="published"?"true":void 0})}}):o.jsx("div",{...f})},BackLink:di,ReferenceChildLink:s=>o.jsx(pi,{...s,previewUrl:i}),ParameterizedLink:()=>o.jsx(o.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:s=>{console.warn("handleEditReference",s)},replaceCurrent:s=>{console.warn("replaceCurrent",s)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:s=>{console.warn("duplicateCurrent",s)},setView:s=>{console.warn("setView",s)},setParams:s=>{var p;t({...s,inspect:(p=s.inspect)!=null?p:void 0})},setPayload:s=>{console.warn("setPayload",s)},navigateIntent:(s,p,f)=>{console.warn("navigateIntent",s,p,f)},createPathWithParams:m}),[m,t,r,i,a]);return o.jsx(sr.Provider,{value:u,children:n})}const fi=ae(Xt)`
  height: 100%;
`,hi=ae(z)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,vi=ae($e)`
  white-space: pre-wrap;
`;function mi(e){const{mainDocumentState:n,onStructureParams:t,previewUrl:r,refs:i}=e,{t:a}=fe(he),{devMode:c}=ge(),v=l.useMemo(()=>i.filter(f=>{var g;return at(f._id)!==((g=n==null?void 0:n.document)==null?void 0:g._id)}).map(f=>f._id),[n,i]),d=l.useMemo(()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:v}},schemaTypeName:"",title:a("document-list-pane.document-list.title"),type:"documentList"}),[v,a]),[m,u]=l.useState(null),s=l.useCallback(()=>u(null),[]),[p]=l.useState(()=>({}));return l.useEffect(()=>u(null),[i]),m?o.jsx(ht,{flex:1,message:a("document-list-pane.error.text"),onRetry:s,children:c&&o.jsx(H,{overflow:"auto",padding:3,radius:2,tone:"critical",children:o.jsxs(pe,{space:3,children:[o.jsx(_e,{muted:!0,size:0,children:a("presentation-error.label")}),o.jsx(vi,{size:1,children:m.error.message})]})})}):o.jsx(Zt,{onCatch:u,children:o.jsx(fi,{children:o.jsx(Yt,{children:o.jsx(dn,{onStructureParams:t,params:p,previewUrl:r,refs:i,children:o.jsx(hi,{direction:"column",flex:1,children:o.jsx(or,{index:0,itemId:"$root",pane:d,paneKey:"$root"})})})})})})}const gi=ae($e)`
  white-space: pre-wrap;
`;function yi(e){const{documentId:n,documentType:t,onFocusPath:r,onStructureParams:i,params:a,previewUrl:c}=e,{template:v,templateParams:d}=a,{t:m}=fe(he),{devMode:u}=ge(),s=l.useMemo(()=>({id:n,options:{id:n,type:t,template:v,templateParameters:cr(d)},title:"",type:"document"}),[n,t,v,d]),[p,f]=l.useState(null),g=l.useCallback(()=>f(null),[]);return l.useEffect(()=>{f(null)},[n,t,a]),p?o.jsx(ht,{flex:1,message:m("document-pane.error.text"),onRetry:g,children:u&&o.jsx(H,{overflow:"auto",padding:3,radius:2,tone:"critical",children:o.jsxs(pe,{space:3,children:[o.jsx(_e,{muted:!0,size:0,children:m("presentation-error.label")}),o.jsx(gi,{size:1,children:p.error.message})]})})}):o.jsx(Zt,{onCatch:f,children:o.jsx(Xt,{style:{height:"100%"},children:o.jsx(dn,{onStructureParams:i,params:a,previewUrl:c,children:o.jsx(lr,{paneKey:"document",index:1,itemId:"document",pane:s,onFocusPath:r})})})})}function bi(e){const{documentId:n,documentType:t,onFocusPath:r,onStructureParams:i,previewUrl:a,structureParams:c}=e;return o.jsx(Yt,{children:o.jsx(yi,{documentId:n,documentType:t,onFocusPath:r,onStructureParams:i,params:c,previewUrl:a})})}function xi(e){const{documentId:n,documentType:t,mainDocumentState:r,onFocusPath:i,onStructureParams:a,previewUrl:c,refs:v,structureParams:d}=e,{t:m}=fe(he),u=er(),s=l.useCallback(p=>o.jsx(De,{...p,state:{id:r.document._id,type:r.document._type,_searchParams:Object.entries({preview:c})}}),[r,c]);return n&&t?o.jsx(bi,{documentId:n,documentType:t,onFocusPath:i,onStructureParams:a,previewUrl:c,structureParams:d}):o.jsxs(z,{direction:"column",flex:1,height:"fill",children:[r&&o.jsx(H,{padding:3,tone:r.document?"inherit":"caution",children:r.document?o.jsx(H,{as:s,"data-as":"a",padding:0,radius:2,children:o.jsx(tr,{schemaType:u.get(r.document._type),status:o.jsx(nr,{children:m("main-document.label")}),value:r.document})}):o.jsx(H,{padding:2,radius:2,tone:"inherit",children:o.jsxs(z,{gap:3,children:[o.jsx(F,{flex:"none",children:o.jsx(A,{size:1,children:o.jsx(rr,{})})}),o.jsx(F,{flex:1,children:o.jsx(A,{size:1,children:o.jsx(ir,{t:m,i18nKey:"main-document.missing.text",components:{Code:"code"},values:{path:r.path}})})})]})})}),o.jsx(mi,{mainDocumentState:r,onStructureParams:a,previewUrl:c,refs:v})]})}const wi=ae.div`
  position: relative;
`,ji=ae.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&`
    /* Hover effect */
    & > span:nth-child(2) {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: 9px;
      bottom: 0;
      background-color: var(--card-border-color);
      opacity: 0;
      transition: opacity 150ms;
    }

    @media (hover: hover) {
      &:hover > span:nth-child(2) {
        opacity: 0.2;
      }
    }
  `}
`,pn=function({id:e,order:n,disabled:t=!1}){const r=l.useRef(null),i=l.useContext(We);if(i===null)throw Error("Panel components must be rendered within a PanelGroup container");const a=function(h){return l.useRef(h||Ce()).current}(e),{activeResizer:c,drag:v,startDragging:d,stopDragging:m,registerElement:u,unregisterElement:s}=i,p=c===a;if(i===null)throw Error("Panel components must be rendered within a PanelGroup container");const f=l.useCallback(h=>{d(a,h.nativeEvent)},[a,d]),g=l.useCallback(h=>{v(a,h)},[a,v]),b=l.useCallback(()=>{r.current.blur(),m()},[m]);return l.useEffect(()=>{if(p&&!t)return window.addEventListener("mousemove",g),window.addEventListener("mouseup",b),()=>{window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",b)}},[t,p,g,b]),l.useLayoutEffect(()=>(u(a,{id:a,order:n,type:"resizer",el:r}),()=>{s(a)}),[a,n,u,s]),o.jsx(wi,{onMouseDown:f,ref:r,children:o.jsxs(ji,{$disabled:t,children:[o.jsx("span",{}),o.jsx("span",{})]})})},Pi=e=>{const{documentId:n,setDisplayedDocument:t,getCommentIntent:r}=e;return o.jsxs(o.Fragment,{children:[o.jsx(pn,{order:4}),o.jsx(ft,{id:"content",minWidth:325,order:5,children:o.jsx(dr,{documentId:n,setDisplayedDocument:t,children:o.jsx(ar,{getIntent:r,children:e.children})})})]})},Ei=e=>{const{documentsOnPage:n,getCommentIntent:t,mainDocumentState:r,onFocusPath:i,onStructureParams:a,params:c,setDisplayedDocument:v,structureParams:d}=e;return o.jsx(Pi,{documentId:c.id,getCommentIntent:t,setDisplayedDocument:v,children:o.jsx(xi,{documentId:c.id,documentType:c.type,mainDocumentState:r,onFocusPath:i,onStructureParams:a,previewUrl:c.preview,refs:n,structureParams:d})})},Si=function(e){const{children:n,navigate:t}=e,r=l.useCallback((i,a=void 0)=>{t(a||{},i?{preview:i}:{})},[t]);return o.jsx(Kn.Provider,{value:r,children:n})};function ki(e){const{unstable_navigator:n}=e,t=!(n==null||!n.component),[r,i]=function(d,m){const[u,s]=l.useState(()=>{var p;return JSON.parse((p=localStorage.getItem(d))!=null?p:JSON.stringify(m))});return l.useEffect(()=>{localStorage.setItem(d,JSON.stringify(u))},[d,u]),[u,s]}("presentation/navigator",t),a=!!t&&r,c=l.useMemo(()=>{if(t)return()=>i(d=>!d)},[t,i]),v=l.useCallback(function(){return o.jsx(o.Fragment,{children:a&&o.jsx(Ci,{...n})})},[a,n]);return[{navigatorEnabled:a,toggleNavigator:c},v]}const Ci=l.memo(function(e){const{minWidth:n,maxWidth:t,component:r}=e,i=n!=null&&t!=null&&n===t;return o.jsxs(o.Fragment,{children:[o.jsx(ft,{id:"navigator",minWidth:n,maxWidth:t,order:1,children:o.jsx(r,{})}),o.jsx(pn,{order:2,disabled:i})]})}),Ii=function(e){const{children:n,params:t}=e,r=l.useMemo(()=>t,[t]);return o.jsx(Bn.Provider,{value:r,children:n})},Ri=function(e){const{children:n,devMode:t,name:r,navigate:i,params:a,structureParams:c}=e,v=l.useMemo(()=>({devMode:t,name:r,navigate:i,params:a,structureParams:c}),[t,r,i,a,c]);return o.jsx(qn.Provider,{value:v,children:n})},vt="ACTION_IFRAME_LOADED",et="ACTION_IFRAME_REFRESH",tt="ACTION_IFRAME_RELOAD",nt="ACTION_PERSPECTIVE",rt="ACTION_VIEWPORT",fn="ACTION_VISUAL_EDITING_OVERLAYS_TOGGLE",_i=(e,n)=>{switch(n.type){case vt:return e.iframe.status==="loaded"?e:{...e,iframe:{...e.iframe,status:"loaded"}};case et:return e.iframe.status==="refreshing"?e:{...e,iframe:{...e.iframe,status:"refreshing"}};case tt:return e.iframe.status==="reloading"?e:{...e,iframe:{...e.iframe,status:"reloading"}};case nt:return{...e,perspective:Ye(hn,n.perspective)};case rt:return{...e,viewport:Ye(vn,n.viewport)};case fn:return $i(e,n);default:return e}},$i=(e,n)=>e.visualEditing.overlaysEnabled===n.enabled?e:{...e,visualEditing:{...e.visualEditing,overlaysEnabled:n.enabled}},Ti=dt(pt(),!1),Oi=Ue(["loading","loaded","refreshing","reloading"]),hn=dt(Ue(["published","previewDrafts"]),"previewDrafts"),vn=dt(Ue(["desktop","mobile"]),"desktop"),Ai=Ie({mainDocument:Ti,iframe:Ie({status:Oi}),perspective:hn,viewport:vn,visualEditing:Ie({overlaysEnabled:pt()})}),Di={mainDocument:!1,iframe:{status:"loading"},perspective:"previewDrafts",viewport:"desktop",visualEditing:{overlaysEnabled:!1}};function Li(e){return Ye(Ai,{...Di,...e})}const zi=Vt(ae.iframe`
  border: 0;
  max-height: 100%;
  width: 100%;
  display: block;
`),Mi=function(e){var n;const{fontSize:t=1,onChange:r,origin:i,padding:a=3,prefix:c,suffix:v,value:d}=e,{t:m}=fe(he),{basePath:u="/"}=((n=Gt())==null?void 0:n.activeWorkspace)||{},s=l.useRef(null),[p,f]=l.useState(void 0),[g,b]=l.useState(void 0),h=l.useCallback(w=>{f(w.currentTarget.value)},[]),x=l.useCallback(w=>{var E;if(w.key==="Enter"){if(p===void 0)return;const y=p.startsWith("/")||p===""?`${i}${p}`:p;if(!y.startsWith(i+"/")&&y!==i)return void b(m("preview-location-input.error",{origin:i,context:"missing-origin"}));if(!i&&(y.startsWith(`${u}/`)||y===u))return void b(m("preview-location-input.error",{basePath:u,context:"same-base-path"}));const P=y===i?i+"/":y;b(void 0),f(void 0),r(P.slice(i.length)),(E=s.current)==null||E.blur()}w.key==="Escape"&&(b(void 0),f(void 0))},[u,r,i,p,m]),j=l.useCallback(()=>{b(void 0),f(void 0)},[]);l.useEffect(()=>{b(void 0),f(void 0)},[i,d]);const C=l.useMemo(()=>({icon:Vn}),[]);return o.jsx(o.Fragment,{children:o.jsx(Hn,{clearButton:g?C:void 0,customValidity:g,fontSize:t,onBlur:j,onClear:()=>{b(void 0),f(i+d)},onChange:h,onKeyDownCapture:x,padding:a,prefix:c,style:{zIndex:1},radius:2,ref:s,space:a,suffix:v,value:p===void 0?`${i}${d}`:p})})};function Ui(e){const{initialUrl:n,openPopup:t,previewLocationOrigin:r,previewLocationRoute:i}=e,{t:a}=fe(he),c=l.useCallback(v=>{v.preventDefault(),t(v.currentTarget.href)},[t]);return o.jsxs(o.Fragment,{children:[o.jsx(Wi,{initialUrl:n,previewLocationOrigin:r,previewLocationRoute:i}),o.jsx(Re,{icon:Jn,text:a("share-url.menu-item.open.text"),as:"a",href:`${r}${i}`,onClick:c,rel:"opener",target:"_blank"})]})}function Wi(e){const{initialUrl:n,previewLocationOrigin:t,previewLocationRoute:r}=e,{t:i}=fe(he),{push:a}=Gn(),c=Te({apiVersion:Oe}),v=Xe(),[d,m]=l.useState(!1);return o.jsx(Re,{disabled:d,onClick:()=>{if(navigator==null||!navigator.clipboard)return a({closable:!0,status:"error",title:i("share-url.clipboard.status",{context:"unsupported"})}),!1;m(!0);let u,s=`${t}${r}`;const p=()=>{a({id:u,closable:!0,status:"success",title:i("share-url.clipboard.status",{context:"success"})}),m(!1)},f=g=>{a({closable:!0,status:"error",title:i("share-url.clipboard.status",{context:"failed"}),description:g.message||g.toString()}),m(!1)};if(_r(n)&&typeof ClipboardItem<"u"){const g="text/plain",b=async()=>{u=a({closable:!0,title:i("share-url.clipboard.status",{context:"copying"})});const x=await rn(c,"@sanity/presentation",typeof window>"u"?"":location.href,v==null?void 0:v.id);return s=$r(n,x.secret,r).toString(),new Blob([s],{type:g})},h=new ClipboardItem({[g]:b()});navigator.clipboard.write([h]).then(p).catch(f)}else navigator.clipboard.writeText(s).then(p).catch(f)},text:i("share-url.menu-item.copy.text"),icon:Xn})}const He=Vt(z),Je={previewDrafts:"preview-frame.perspective.previewDrafts.title",published:"preview-frame.perspective.published.title"},Ni="caution",Fi="positive",Ft={previewDrafts:Zn,published:Yn},Ki=l.forwardRef(function(e,n){const{dispatch:t,iframe:r,initialUrl:i,loadersConnection:a,navigatorEnabled:c,onPathChange:v,onRefresh:d,openPopup:m,overlaysConnection:u,params:s,perspective:p,targetOrigin:f,toggleNavigator:g,toggleOverlay:b,viewport:h,visualEditing:{overlaysEnabled:x}}=e,{t:j}=fe(he),{devMode:C}=ge(),w=Pn(),E=l.useCallback(()=>t({type:rt,viewport:"desktop"}),[t]),y=l.useCallback(()=>t({type:rt,viewport:"mobile"}),[t]),P=r.status==="loading"||r.status==="reloading",[k,I]=l.useState(!1),T=r.status==="refreshing",[D,J]=l.useState(!1),ce=P||T||u==="connecting",X=l.useMemo(()=>f===location.origin?"":f,[f]),W=l.useCallback(()=>{d(()=>{typeof n=="function"||n==null||!n.current||(t({type:tt}),n.current.src=`${f}${s.preview||"/"}`)})},[t,d,s.preview,f,n]),Z=l.useCallback(()=>{typeof n=="function"||n==null||!n.current||(n.current.src=i.toString(),t({type:tt}))},[t,n,i]),le=l.useCallback(()=>{ve(!0)},[]),[N,ve]=l.useState(!1),[Y,Q]=l.useState(!1);l.useEffect(()=>{if(!(P||T||u!=="connecting"&&u!=="reconnecting")){const O=setTimeout(()=>{Q(!0)},1e3);return()=>clearTimeout(O)}},[u,P,T]),l.useEffect(()=>{if(!P&&!T&&Y){if(u==="connected"&&(J(!1),Q(!1),I(!1),ve(!1)),u==="connecting"){const O=setTimeout(()=>{I(!0),console.error("Unable to connect to visual editing. Make sure you've setup '@sanity/visual-editing' correctly")},wt);return()=>clearTimeout(O)}if(u==="reconnecting"){const O=setTimeout(()=>{I(!0),J(!0)},wt);return()=>clearTimeout(O)}u==="disconnected"&&J(!0)}},[P,u,T,Y]);const G=l.useMemo(()=>{const O=new URL(s.preview||"/",f),{pathname:ee,search:oe}=Rr(O);return`${ee}${oe}`},[s.preview,f]),ye=l.useCallback(()=>{t({type:vt})},[t]);return l.useEffect(()=>{if(typeof n=="function"||n==null||!n.current)return;const O=n.current;function ee(){O===document.activeElement&&O.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0}))}return window.addEventListener("blur",ee),()=>{window.removeEventListener("blur",ee)}},[n]),o.jsx(pr,{transition:w?{duration:0}:void 0,children:o.jsxs(En,{delay:1e3,children:[o.jsx(H,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:o.jsxs(z,{align:"center",style:{minHeight:0},children:[g&&o.jsx(F,{flex:"none",marginRight:1,padding:1,children:o.jsx(je,{animate:!0,content:o.jsx(A,{size:1,children:j("preview-frame.navigator.toggle-button.tooltip")}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:o.jsx(ie,{"aria-label":j("preview-frame.navigator.toggle-button.aria-label"),fontSize:1,icon:Sn,mode:"bleed",onClick:g,padding:2,selected:c})})}),o.jsx(je,{animate:!0,content:o.jsxs(z,{align:"center",style:{whiteSpace:"nowrap"},children:[o.jsx(F,{padding:1,children:o.jsx(A,{size:1,children:j("preview-frame.overlay.toggle-button.tooltip",{context:x?"disable":"enable"})})}),o.jsx(F,{paddingY:1,children:o.jsx(kn,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:o.jsx(H,{as:"label",flex:"none",marginRight:1,padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:x?"transparent":void 0,children:o.jsxs(z,{align:"center",gap:3,children:[o.jsx("div",{style:{margin:-4},children:o.jsx(Cn,{checked:x,onChange:b,disabled:r.status==="loading"||u!=="connected"})}),o.jsx(F,{children:o.jsx(A,{muted:!x,size:1,weight:"medium",children:j("preview-frame.overlay.toggle-button.text")})})]})})}),o.jsx(F,{flex:1,marginX:1,children:o.jsx(Mi,{prefix:o.jsx(F,{padding:1,children:o.jsx(je,{animate:!0,content:o.jsx(A,{size:1,children:r.status==="loaded"?j("preview-frame.refresh-button.tooltip"):j("preview-frame.status",{context:r.status})}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:o.jsx(ie,{"aria-label":j("preview-frame.refresh-button.aria-label"),fontSize:1,icon:In,mode:"bleed",loading:r.status==="reloading"||r.status==="refreshing",onClick:W,padding:2})})}),onChange:v,origin:X,suffix:o.jsx(F,{padding:1,children:o.jsx(jt,{button:o.jsx(ie,{fontSize:1,iconRight:Rn,mode:"bleed",padding:2,space:2}),id:"location-menu",menu:o.jsx(Pt,{children:o.jsx(Ui,{initialUrl:i,openPopup:m,previewLocationOrigin:X,previewLocationRoute:G})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),value:G})}),o.jsx(z,{align:"center",flex:"none",gap:1,padding:1,children:o.jsx(jt,{button:o.jsx(ie,{fontSize:1,iconRight:_n,mode:"bleed",padding:2,space:2,text:j(Je[a==="connected"?p:"previewDrafts"]),loading:a==="reconnecting"&&r.status!=="loaded",disabled:a!=="connected"}),id:"perspective-menu",menu:o.jsxs(Pt,{style:{maxWidth:240},children:[o.jsx(Re,{fontSize:1,onClick:()=>t({type:nt,perspective:"previewDrafts"}),padding:3,pressed:p==="previewDrafts",tone:Ni,children:o.jsxs(z,{align:"flex-start",gap:3,children:[o.jsx(F,{flex:"none",children:o.jsx(A,{size:1,children:l.createElement(Ft.previewDrafts)})}),o.jsxs(pe,{flex:1,space:2,children:[o.jsx(A,{size:1,weight:"medium",children:j(Je.previewDrafts)}),o.jsx(A,{muted:!0,size:1,children:j("preview-frame.perspective.previewDrafts.text")})]}),o.jsx(F,{flex:"none",children:o.jsx(A,{muted:!0,size:1,style:{opacity:p==="previewDrafts"?1:0},children:o.jsx(Et,{})})})]})}),o.jsx(Re,{fontSize:1,onClick:()=>t({type:nt,perspective:"published"}),padding:3,pressed:p==="published",tone:Fi,children:o.jsxs(z,{align:"flex-start",gap:3,children:[o.jsx(F,{flex:"none",children:o.jsx(A,{size:1,children:l.createElement(Ft.published)})}),o.jsxs(pe,{flex:1,space:2,children:[o.jsx(A,{size:1,weight:"medium",children:j(Je.published)}),o.jsx(A,{muted:!0,size:1,children:j("preview-frame.perspective.published.text")})]}),o.jsx(F,{flex:"none",children:o.jsx(A,{muted:!0,size:1,style:{opacity:p==="published"?1:0},children:o.jsx(Et,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),o.jsxs(z,{align:"center",flex:"none",gap:1,padding:1,children:[o.jsx(je,{animate:!0,content:o.jsx(A,{size:1,children:j("preview-frame.viewport-full-button.tooltip")}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:o.jsx(ie,{"aria-label":j("preview-frame.viewport-full-button.aria-label"),fontSize:1,icon:$n,mode:"bleed",onClick:E,padding:2,selected:h==="desktop"})}),o.jsx(je,{animate:!0,content:o.jsx(A,{size:1,children:j("preview-frame.viewport-narrow-button.tooltip")}),padding:2,placement:"bottom",portal:!0,children:o.jsx(ie,{"aria-label":j("preview-frame.viewport-narrow-button.aria-label"),fontSize:1,icon:Tn,mode:"bleed",onClick:y,padding:2,selected:h==="mobile"})})]})]})}),o.jsx(H,{flex:1,tone:"transparent",children:o.jsxs(z,{align:"center",height:"fill",justify:"center",padding:h==="desktop"?0:2,sizing:"border",style:{position:"relative",cursor:ce?"wait":void 0},children:[o.jsx(On,{children:D||P||T||!Y||N?(P||u==="connecting"&&r.status!=="refreshing")&&!N?o.jsx(He,{initial:"initial",animate:"animate",exit:"exit",variants:Kt,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:o.jsxs(z,{style:{...Ae[h]},justify:"center",align:"center",direction:"column",gap:4,children:[o.jsx(St,{muted:!0}),o.jsx(A,{muted:!0,size:1,children:j("preview-frame.status",{context:"loading"})})]})}):D&&!N?o.jsx(He,{initial:"initial",animate:"animate",exit:"exit",variants:Bi,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:o.jsx(ht,{flex:1,message:j("preview-frame.connection.error.text"),onRetry:Z,onContinueAnyway:le,children:C&&o.jsxs(o.Fragment,{children:[u!=="connected"&&o.jsx(H,{padding:3,radius:2,tone:"critical",children:o.jsxs(pe,{space:3,children:[o.jsx(_e,{muted:!0,size:0,children:j("preview-frame.overlay.connection-status.label")}),o.jsx($e,{size:1,children:j("channel.status",{context:u})})]})}),a!=="connected"&&o.jsx(H,{padding:3,radius:2,tone:"critical",children:o.jsxs(pe,{space:3,children:[o.jsx(_e,{muted:!0,size:0,children:j("preview-frame.loader.connection-status.label")}),o.jsx($e,{size:1,children:j("channel.status",{context:a})})]})})]})})}):null:o.jsx(He,{initial:"initial",animate:"animate",exit:"exit",variants:Kt,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:k?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:k?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:o.jsxs(z,{style:{...Ae[h]},justify:"center",align:"center",direction:"column",gap:4,children:[k&&o.jsx(ie,{disabled:!0,fontSize:1,mode:"ghost",text:j("preview-frame.continue-button.text"),style:{opacity:0}}),o.jsx(H,{radius:2,tone:k?"caution":"inherit",padding:4,shadow:1,children:o.jsxs(z,{justify:"center",align:"center",direction:"column",gap:4,children:[o.jsx(St,{muted:!0}),o.jsx(A,{muted:!0,size:1,children:j("preview-frame.status",k?{context:"timeout"}:{context:"connecting"})})]})}),k&&o.jsx(ie,{fontSize:1,tone:"critical",onClick:le,text:j("preview-frame.continue-button.text")})]})})}),o.jsx(zi,{ref:n,style:{pointerEvents:(P||u==="connecting"&&r.status!=="refreshing")&&!N?"none":"auto",boxShadow:"0 0 0 1px var(--card-border-color)",borderTop:"1px solid transparent"},src:i.toString(),initial:["background"],variants:qi,animate:[(P||u==="connecting"&&r.status!=="refreshing")&&!N?"background":"active",P?"reloading":"idle",h,Y&&!N?"timedOut":""],onLoad:ye})]})})]})})}),Ae={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},Kt={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Bi={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},qi={desktop:{...Ae.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...Ae.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};let Bt=!1;function qt(e,n){return e instanceof Function?e(n):e}function Vi(e,n){const t=Array.isArray(e)?e:[e];for(e of t){let r,i=e;if(typeof e=="string")try{const a=new URL(e);r=a.origin,i=a.pathname}catch{}if(!r||n.origin===r)try{const a=Ar(i,{decode:decodeURIComponent})(n.pathname);if(a){const{params:c,path:v}=a;return{origin:r,params:c,path:v}}}catch{throw new Error(`"${e}" is not a valid route pattern`)}}}function Hi(e){const{navigate:n,resolvers:t=[],path:r,previewUrl:i}=e,{state:a}=it(),c=Qn(),v=Te({apiVersion:Oe}),[d,m]=l.useState(void 0),u=l.useRef(void 0),s=l.useMemo(()=>{var f,g;const b=r||((g=(f=a._searchParams)==null?void 0:f.find(([x])=>x==="preview"))==null?void 0:g[1])||"",h=typeof i=="string"?i:typeof i=="object"&&(i==null?void 0:i.origin)||location.origin;return new URL(b,h)},[r,i,a._searchParams]),p=l.useCallback(()=>{m(void 0),u.current=void 0},[]);return l.useEffect(()=>{if(t.length&&s){let j;for(const C of t){const w=Vi(C.route,s);if(w){j={context:w,resolver:C};break}}if(j){const C=function(E,y){var P;if(E.resolve){const k=(P=E.resolve(y))==null?void 0:P.filter;return k?`*[${k}][0]{_id, _type}`:void 0}return"type"in E?`*[_type == "${E.type}"][0]{_id, _type}`:`*[${qt(E.filter,y)}][0]{_id, _type}`}(j.resolver,j.context),w=(f=j.resolver,g=j.context,f.resolve?(h=(b=f.resolve(g))==null?void 0:b.params)!=null?h:g.params:"type"in f?{}:(x=qt(f.params,g))!=null?x:g.params);if(C){const E=new AbortController,y={perspective:"previewDrafts",signal:E.signal};return v.fetch(C,w,y).then(P=>{(!P||u.current!==P._id)&&(m({document:P,path:s.pathname}),n==null||n({id:P==null?void 0:P._id,type:P==null?void 0:P._type}),u.current=P==null?void 0:P._id)}).catch(P=>{P instanceof Error&&P.name==="AbortError"||(m({document:void 0,path:s.pathname}),u.current=void 0)}),()=>{E.abort()}}}}var f,g,b,h,x;p()},[v,p,c,n,t,s]),d}function Ji(e){var n;if(e===void 0)return;const t=(n=decodeURIComponent(e))==null?void 0:n.split(".");return t[0]==="drafts"&&t.shift(),t.join(".")}function Gi(e){if(e!==void 0)return tn.toString(function(n){const t=[];for(const r of n.split(".")){const i=ti.exec(r);if(i){t.push(i[1],Number(i[2]));continue}const a=ni.exec(r);if(a){t.push(a[1],[Number(a[2]),Number(a[3])]);continue}const c=ri.exec(r);c?t.push(c[1],{_key:c[2]}):t.push(r)}return t}(decodeURIComponent(e)))}function Ge(e){return Object.fromEntries(Object.entries(e).filter(([,n])=>n!==void 0&&n!==""&&n!==null))}function Xi({initialPreviewUrl:e,routerNavigate:n,routerState:t,routerSearchParams:r,frameStateRef:i}){const a=l.useMemo(()=>{const{id:d,path:m,type:u}={id:Ji((s=t).id),path:Gi(s.path),type:s.type};var s;return{id:d,type:u,path:m,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,viewport:r.viewport,inspect:r.inspect,rev:r.rev,prefersLatestPublished:r.prefersLatestPublished,since:r.since,template:r.template,templateParams:r.templateParams,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment}},[t,r,e]),c=l.useMemo(()=>Ge({inspect:a.inspect,path:a.path,rev:a.rev,prefersLatestPublished:a.prefersLatestPublished,since:a.since,template:a.template,templateParams:a.templateParams,view:a.view,pathKey:a.pathKey,instruction:a.instruction,comment:a.comment}),[a.comment,a.inspect,a.instruction,a.path,a.pathKey,a.prefersLatestPublished,a.rev,a.since,a.template,a.templateParams,a.view]),v=l.useRef(t);return l.useEffect(()=>{v.current=t},[t]),{structureParams:c,navigate:l.useCallback((d,m={},u)=>{d.id&&(d.id=at(d.id));const{_searchParams:s,...p}=v.current,f=(s||[]).reduce((x,[j,C])=>(x[j]=C,x),{}),g=Ge({...p,...d}),b=Ge({...f,...m});p.id!==g.id&&(delete b.template,delete b.templateParams),g._searchParams=Object.entries(b).reduce((x,[j,C])=>[...x,[j,C]],[]);const h=u??b.preview===i.current.url;n(g,{replace:h})},[n,i]),params:a}}function Zi(e,n,t){var r,i;const a=Te({apiVersion:Oe}),c=Gt(),v=((r=c==null?void 0:c.activeWorkspace)==null?void 0:r.basePath)||"/",d=((i=c==null?void 0:c.activeWorkspace)==null?void 0:i.name)||"default",m=function(s,p,f,g){const[b,h]=l.useState(()=>g||""),x=l.useRef(0);l.useEffect(()=>{if(b&&g)return window.clearTimeout(x.current),()=>{x.current=window.setTimeout(()=>{h("")},100)}},[b,g]);const j=Xe();return l.useMemo(()=>["@sanity/presentation",p,f,s,j==null?void 0:j.id,Yi,b],[p,j==null?void 0:j.id,s,f,b])}(n,v,d,t),u=function(s,p){const f=Te({apiVersion:Oe}),g=Xe(),[b,h]=l.useState(""),x=s?_t(async()=>await rn(f,"@sanity/presentation",typeof window>"u"?"":location.href,g==null?void 0:g.id),[...p,b]):null;return l.useEffect(()=>{if(!x)return;const j=setTimeout(()=>{l.startTransition(()=>h(x.expiresAt.toString()))},x.expiresAt.getTime()-Date.now());return()=>clearTimeout(j)},[x]),(x==null?void 0:x.secret)||null}(typeof e=="object"||typeof e=="function",m);return _t(async()=>{if(typeof e=="string"){const p=new URL(e,location.origin);let f=p;try{if(t){const g=new URL(t,p);g.origin===p.origin&&(f=g)}else if(document.referrer){const g=new URL(document.referrer);g.origin===p.origin&&(f=g)}}catch{}return location.origin!==f.origin||!f.pathname.startsWith(`${v}/`)&&f.pathname!==v?f:p}const s=await(typeof e=="object"?Wr(e):e)({client:a,previewUrlSecret:u,previewSearchParam:t,referrer:typeof document>"u"?null:document.referrer,studioBasePath:v});return new URL(s,location.origin)},[...m,u])}const Yi=Symbol(),Qi=l.lazy(()=>Ht(()=>import("./LoaderQueries-1175d4a5.js"),["static/LoaderQueries-1175d4a5.js","static/sanity-6cbb77ad.js","static/DisplayedDocumentBroadcaster-b5c413d9.js"])),ea=l.lazy(()=>Ht(()=>import("./PostMessageRefreshMutations-3e6c014c.js"),["static/PostMessageRefreshMutations-3e6c014c.js","static/sanity-6cbb77ad.js"])),ta=ae(z)`
  overflow-x: auto;
`;function na(e){var n,t,r,i;const{previewUrl:a,components:c}=(n=e.tool.options)!=null?n:{},v=e.tool.name||An,{unstable_navigator:d}=c||{},{navigate:m,state:u}=it(),s=Jt(Object.fromEntries(u._searchParams||[])),p=Zi(a||"/",v,s.preview||null),[f]=l.useState(()=>{var R;const _=(R=e.tool.options)==null?void 0:R.devMode;return typeof _=="function"?_():typeof _=="boolean"?_:typeof window<"u"&&window.location.hostname==="localhost"}),g=l.useMemo(()=>p.origin,[p.origin]),b=l.useRef(null),[h,x]=l.useState(),[j,C]=l.useState({}),w=l.useRef({title:void 0,url:void 0}),{navigate:E,params:y,structureParams:P}=Xi({initialPreviewUrl:p,routerNavigate:m,routerState:u,routerSearchParams:s,frameStateRef:w}),k=l.useMemo(()=>ln(E,50),[E]),[I,T]=l.useReducer(_i,{perspective:y.perspective,viewport:y.viewport},Li),[D,J]=function(R,_){if(R!=="published"&&R!=="previewDrafts")throw new Error(`Invalid perspective: ${R}`);const[L,$]=l.useState({}),[S,q]=l.useState({}),B=l.useRef(""),xe=l.useCallback((ue,M,de=[])=>{const V=de.filter(re=>"_projectId"in re&&re._projectId?(Bt||(console.warn("Cross dataset references are not supported yet, ignoring source document",re),Bt=!0),!1):re);(M==="published"?$:q)(re=>{const we={};for(const Ee of V)we[Ee._id]=Ee;if(B.current!==_.current.url)return B.current=_.current.url,{[ue]:we};const Pe=re[ue];return ur(Pe,we)?re:{...re,[ue]:we}})},[_]);return[l.useMemo(()=>{const ue=Object.values(R==="published"?L:S).reduce((M,de)=>(Object.values(de).forEach(V=>{M[V._id]=V}),M),{});return Object.values(ue)},[R,S,L]),xe]}(I.perspective,w),ce=Dn(),X=Ln(),W=Hi({resolvers:(r=(t=e.tool.options)==null?void 0:t.resolve)==null?void 0:r.mainDocuments,previewUrl:(i=e.tool.options)==null?void 0:i.previewUrl,path:y.preview,navigate:E});l.useEffect(()=>{(I.perspective!==y.perspective||I.viewport!==y.viewport)&&k({},{perspective:I.perspective==="previewDrafts"?void 0:I.perspective,viewport:I.viewport==="desktop"?void 0:I.viewport})},[y.perspective,I.perspective,k,I.viewport,y.viewport,y.rev,y.prefersLatestPublished]);const[Z,le]=l.useState("connecting"),[N,ve]=l.useState("connecting"),[Y,Q]=l.useState("connecting"),[G]=l.useState(()=>new Set),ye=l.useCallback(R=>{const _=window.open(R,"_blank");_&&G.add(_)},[G]);l.useEffect(()=>{if(G.size&&h)for(const R of G)R&&"closed"in R&&!R.closed&&h.addSource(R)},[h,G,G.size]);const O=l.useRef(I.perspective);l.useEffect(()=>{O.current=I.perspective},[I.perspective]),l.useEffect(()=>{var R;const _=(R=b.current)==null?void 0:R.contentWindow;if(!_)return;const L=function($){const{destroy:S,send:q}=Ot($),B=new Set,xe=new WeakMap,ue=new Set;return{destroy:()=>{S();for(const M of ue)M()},send:(M,...de)=>{q(M,...de);for(const V of B)V&&"closed"in V&&!V.closed&&xe.has(V)&&xe.get(V)(M,...de)},addSource(M){if(B.has(M))return;if(!("closed"in M))throw console.warn("Source is unsupported",{source:M}),new Error("Source is unsupported");if(M.closed)throw new Error("Source is closed");const{send:de,destroy:V}=Ot({...$,target:M,connectTo:$.connectTo.map(re=>{const{onStatusUpdate:we,onEvent:Pe,...Ee}=re;return{...Ee,onEvent:Pe?(...bt)=>{const[Ke]=bt;if(Ke!=="preview-kit/documents"&&Ke!=="overlay/navigate"&&Ke!=="loader/documents")return Pe(...bt)}:void 0}})});ue.add(V),xe.set(M,de),B.add(M)}}}({id:"presentation",target:_,targetOrigin:g,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:le,onEvent($,S){if($!=="visual-editing/focus"&&$!=="overlay/focus"||!("id"in S))if($==="visual-editing/navigate"||$==="overlay/navigate"){const{title:q,url:B}=S;w.current.url!==B&&k({},{preview:B}),w.current={title:q,url:B}}else $==="visual-editing/meta"?w.current.title=S.title:$==="visual-editing/toggle"||$==="overlay/toggle"?T({type:fn,enabled:S.enabled}):$==="visual-editing/documents"?J("visual-editing",S.perspective,S.documents):$==="visual-editing/refreshing"&&S.source==="manual"?clearTimeout(gt.current):$==="visual-editing/refreshing"&&S.source==="mutation"?T({type:et}):$==="visual-editing/refreshed"&&T({type:vt});else k({type:S.type,id:S.id,path:S.path},{prefersLatestPublished:"isDraft"in S||O.current==="previewDrafts"?void 0:"true"})}},{id:"loaders",heartbeat:!0,onStatusUpdate:ve,onEvent($,S){if($==="loader/documents"&&S.projectId===ce&&S.dataset===X)J("loaders",S.perspective,S.documents);else if($==="loader/query-listen"&&S.projectId===ce&&S.dataset===X){if(typeof S.heartbeat=="number"&&S.heartbeat<Be)throw new Error(`Loader query listen heartbeat interval must be at least ${Be}ms`);C(q=>{var B;return{...q,[ii(S.query,S.params)]:{perspective:S.perspective,query:S.query,params:S.params,receivedAt:Date.now(),heartbeat:(B=S.heartbeat)!=null&&B}}})}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:Q,onEvent($,S){$==="preview-kit/documents"&&S.projectId===ce&&S.dataset===X&&J("preview-kit",S.perspective,S.documents)}}]});return x(L),()=>{L.destroy(),x(void 0)}},[X,ce,J,k,g]),l.useEffect(()=>{const R=setInterval(()=>C(_=>{if(Object.keys(_).length<1)return _;const L=Date.now();if(!Object.values(_).some(S=>S.heartbeat!==!1&&L>S.receivedAt+S.heartbeat))return _;const $={};for(const[S,q]of Object.entries(_))q.heartbeat!==!1&&L>q.receivedAt+q.heartbeat||($[S]=q);return $}),Be);return()=>clearInterval(R)},[]);const ee=l.useCallback(R=>{k({path:tn.toString(R)},{},!0)},[k]),oe=l.useCallback(R=>{const _=new URL(R,p.origin),L=_.pathname+_.search;_.origin===p.origin&&L!==y.preview&&k({},{preview:L})},[p,y,k]),be=l.useCallback(R=>{k({},R)},[k]);l.useEffect(()=>{h==null||h.send("overlays","presentation/perspective",{perspective:I.perspective})},[h,I.perspective]),l.useEffect(()=>{y.id&&y.path?h==null||h.send("overlays","presentation/focus",{id:y.id,path:y.path}):h==null||h.send("overlays","presentation/blur",void 0)},[h,y.id,y.path]),l.useEffect(()=>{I.perspective==="published"&&y.id&&!y.rev&&!y.prefersLatestPublished&&k({},{prefersLatestPublished:"true"})},[k,y.id,y.prefersLatestPublished,y.rev,I.perspective]),l.useEffect(()=>{w.current.url&&y.preview&&w.current.url!==y.preview&&(w.current.url=y.preview,Z!=="connected"&&b.current?b.current.src=`${g}${y.preview}`:h==null||h.send("overlays","presentation/navigate",{url:y.preview,type:"replace"}))},[h,Z,g,y.preview]);const K=l.useCallback(()=>h==null?void 0:h.send("overlays","presentation/toggleOverlay",void 0),[h]),[te,ne]=l.useState(null);l.useEffect(()=>{const R=L=>{Dt(L)&&K()},_=L=>{var $;Dt(L)&&K(),$=L,["mod","\\"].every(S=>At[S]?$[At[S]]:$.key===S.toUpperCase())&&K()};return window.addEventListener("keydown",_),window.addEventListener("keyup",R),()=>{window.removeEventListener("keydown",_),window.removeEventListener("keyup",R)}},[K]);const[se,Ne]=l.useState(null),[{navigatorEnabled:mt,toggleNavigator:mn},gn]=ki({unstable_navigator:d}),Fe=l.useRef(y.id);l.useEffect(()=>{y.rev&&Fe.current&&y.id!==Fe.current&&k({},{rev:void 0}),Fe.current=y.id});const gt=l.useRef(),yn=l.useCallback(R=>{if(T({type:et}),h)return gt.current=window.setTimeout(R,300),void h.send("overlays","presentation/refresh",{source:"manual",livePreviewEnabled:Y==="connected"||N==="connected"});R()},[h,N,Y]),yt=zn(),bn=l.useCallback(({id:R,type:_,path:L})=>{if(w.current.url)return{title:w.current.title||w.current.url,name:"edit",params:{id:R,path:L,type:_,inspect:Mn,workspace:yt.name,mode:Un,preview:y.preview}}},[y.preview,yt.name]);return o.jsxs(o.Fragment,{children:[o.jsx(Ri,{devMode:f,name:v,navigate:k,params:y,structureParams:P,children:o.jsx(Si,{navigate:k,children:o.jsx(Ii,{params:y,children:o.jsx(ta,{height:"fill",children:o.jsxs(li,{children:[o.jsx(gn,{}),o.jsx(ft,{id:"preview",minWidth:325,defaultSize:mt?50:75,order:3,children:o.jsx(z,{direction:"column",flex:1,height:"fill",ref:Ne,children:o.jsx(Wn,{element:se,children:o.jsx(Ki,{dispatch:T,iframe:I.iframe,initialUrl:p,loadersConnection:N,navigatorEnabled:mt,onPathChange:oe,onRefresh:yn,openPopup:ye,overlaysConnection:Z,params:y,perspective:I.perspective,ref:b,targetOrigin:g,toggleNavigator:mn,toggleOverlay:K,viewport:I.viewport,visualEditing:I.visualEditing})})})}),o.jsx(Ei,{mainDocumentState:W,params:y,documentsOnPage:D,getCommentIntent:bn,onFocusPath:ee,onStructureParams:be,setDisplayedDocument:ne,structureParams:P})]})})})})}),h&&o.jsx(l.Suspense,{children:o.jsx(Qi,{channel:h,liveQueries:j,perspective:I.perspective,liveDocument:te,documentsOnPage:D})}),h&&y.id&&y.type&&o.jsx(l.Suspense,{children:o.jsx(ea,{channel:h,id:y.id,type:y.type,loadersConnection:N,previewKitConnection:Y})})]})}const ca=Object.freeze(Object.defineProperty({__proto__:null,default:na},Symbol.toStringTag,{value:"Module"}));export{kt as D,ca as P,vr as a,aa as g,oa as p,sa as r,mr as t,qe as w};
